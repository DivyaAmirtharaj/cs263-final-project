# CS 263 Final Project

In the LLVM project repo, to compile LLVM with the additional CodeGen pass:

```bash
cmake -S llvm -B build -G Ninja -DCMAKE_BUILD_TYPE=Release -DLLVM_TARGETS_TO_BUILD=X86
ninja -C build
```

In this repo, to compile (to LLVM) the code you want to run the pass on, and then compile the LLVM to assembly code (including the additional CodeGen pass):

```bash
clang -S -emit-llvm -o example.ll example.c -arch x86_64
/path/to/llvm/repo/build/bin/llc  example.ll -o output.S  > example_bb_identifiers.txt
```

Note that we redirect the output of `llc` (the identifiers of the basic blocks)
to a text file so that we can use it in the objdump parser script.

To compare with the original assembly code generated by LLVM:

```bash
clang -S -o example.S example.c -arch x86_64
```

To compile the assembly code to an executable:

```bash
clang -o example example.S -arch x86_64
```

To disassemble the executable:

```bash
objdump -d -S example > example_objdump.txt
```

Then edit example_objdump.txt to remove the all code besides main and the
functions within the source file (i.e. remove _init, _start, .plt, etc.).

To parse the objdump file into machine code bytes (the file names/paths can be edited in the python script):

```bash
python objdump_parser.py
```

Note that due to addresses above `0x7fffffff` being unable to be mapped for our code, we manually changed some identifiers after running the parser. If all code addresses are fine, then this extra step after parsing is unnecessary.

To compile the injector:    
```bash
g++ injector.cpp -o injector
g++ mmapper.cpp -o mmapper
```
    

To read the machine code bytes and run the HashLR version of the executable:
```bash
./injector [parsed_file]
```