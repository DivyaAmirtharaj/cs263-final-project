# CS 263 Final Project

In the LLVM project repo, to compile LLVM with the additional CodeGen pass:

```bash
cmake -S llvm -B build -G Ninja -DCMAKE_BUILD_TYPE=Release -DLLVM_TARGETS_TO_BUILD=X86
ninja -C build
```

In this repo, to compile (to LLVM) the code you want to run the pass on, and then compile the LLVM to assembly code (including the additional CodeGen pass):

```bash
clang -S -emit-llvm -o example.ll example.c -arch x86_64
/path/to/llvm/repo/build/bin/llc  example.ll -o example-hashlr.S  > example_bb_identifiers.txt
```

Note that we redirect the output of `llc` (the identifiers of the basic blocks)
to a text file so that we can use it in the objdump parser script.

To compare with the original assembly code generated by LLVM:

```bash
clang -S -o example.S example.c -arch x86_64
```

To compile the HashLR version of the assembly code to an executable binary file:

```bash
clang -o example-hashlr example-hashlr.S -arch x86_64
```

To extract the machine code bytes from the executable binary so that the injector can use it:

```bash
python binary_parser.py -b example-hashlr -i example_bb_identifiers.txt -o example_bytes.txt
```

Note that due to addresses above `0x7fffffff` being unable to be mapped for our code, we manually changed some identifiers after running the parser. If all code addresses are fine, then this extra step after parsing is unnecessary.

To compile the injector:

```bash
g++ injector.cpp -o injector
gcc mmapper.o -o mmapper
```

Note that for our testing, we opted to explicitly set the key (we elaborate on the reason in the paper). Hence, if mmapper is separately compiled, instructions to set %xmm7 to 0x237 (our chosen key for testing) should be added at the beginning.

To read the machine code bytes and run the HashLR version of the executable:

```bash
./injector example_bytes.txt
```
